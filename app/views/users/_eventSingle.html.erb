<div class="panel panel-info">
  <div class="panel-heading">
    <h1 class="panel-title"><%= link_to event.name, event %></h1>
  </div>
  <div class="panel-body">
   <% if event.start_time.strftime("%A, %B %d %Y") 
    .eql? event.end_time.strftime("%A, %B %d %Y")%>

     <%= event.start_time.strftime("%A, %B %d") %> <br>
         <%= event.start_time.strftime("%I:%M %p")%>
         at
         <%= event.location %> <br>
    
    <% else %>
       <%= event.start_time.strftime("%B %d") %> 
       at <%= event.start_time.strftime("%I:%M %p")%> 
       to
      <%= event.end_time.strftime("%B %d") %> 
       at <%= event.end_time.strftime("%I:%M %p")%> <br>
      <%= event.location %> <br>
    <% end %>
    <p>
      Categories:
      <% event.event_categories.each do |cat| %>
      <%= cat.category %>;&nbsp;
      <% end %>
  	</p>
  	<p>
    	<%= truncate(strip_tags(event.description), length: 120) %>
    </p>
    
    <% if !isAttending(current_user.id, event.id) %>
      <%= button_to 'Attend', { controller: 'users', action: 'attendEvent', id: event.id }, remote: true, class: "btn btn-success btn-sm" %>
    <% else %>
      <%= button_to 'Leave', { controller: 'users', action: 'leaveEvent', id: event.id }, remote: true, class: "btn btn-warning btn-sm" %>
    <% end %>
  </div>
  
  <ul class="list-group">
    <% if getComments(event.id).count > 4 %>
      <li class="list-group-item" style="text-align: right">
        <button class="btn btn-info btn-xs" type="button" data-toggle="collapse" data-target="#collapse<%= event.id %>" aria-expanded="true" aria-controls="collapse<%= event.id %>">
          <small>Older Comments</small>
        </button>
      </li>
      <div class="collapse" id="collapse<%= event.id %>">
        <% getComments(event.id) .each_with_index do |c, i| %>
          <% if i < getComments(event.id).count - 2 %>
            <li class="list-group-item">
              <div class="row">
                <div class="col-md-2">
                  <%= link_to User.find(c.user_id).name %>
                </div>
                <div class="col-md-10">
                  <%= c.message %>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12" style="text-align: right; color: gray">
                  <small ><%= format_time(c.created_at) %></small>
                </div>
              </div>
            </li>
          <% end %>
        <% end %>
      </div>
      <% getComments(event.id) .each_with_index do |c, i| %>
        <% if i >= getComments(event.id).count - 2 %>
          <li class="list-group-item">
            <div class="row">
              <div class="col-md-2">
                <%= link_to User.find(c.user_id).name %>
              </div>
              <div class="col-md-10">
                <%= c.message %>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12" style="text-align: right; color: gray">
                <small ><%= format_time(c.created_at) %></small>
              </div>
            </div>
          </li>
        <% end %>
      <% end %>
    <% else %>
      <% getComments(event.id) .each do |c| %> 
        <li class="list-group-item">
          <div class="row">
            <div class="col-md-2">
              <%= link_to User.find(c.user_id).name %>
            </div>
            <div class="col-md-10">
              <%= c.message %>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12" style="text-align: right; color: gray">
              <small ><%= format_time(c.created_at) %></small>
            </div>
          </div>
        </li>
      <% end %>
    <% end %>
     
    <li class="list-group-item" style="padding-top: 15px; padding-bottom: 0px">
      <div class="row">
        <div class="col-md-12">
          <%= form_for :comment, url: { controller: 'users', action: 'createComment' }, remote: true do |f| %>
            <div class="form-group">            
              <%= f.text_field :message, class: "form-control", placeholder: "Leave a comment..." %>
              <%= f.hidden_field :event_id, :value => event.id %>
              <%= f.hidden_field :user_id, :value => current_user.id %>
            </div>        
          <% end %>
        </div>
      </div>
    </li>
  </ul>   
</div>
