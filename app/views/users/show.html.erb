<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/trunk/richmarker/src/richmarker-compiled.js' type='text/javascript'></script>

<div class="container documents">
	<div class="row">

		<div class="col-md-6">

			<h2>Events Near You</h2>

			<br/> <br/>

			<% @near_me.each do |e| %>
			<div id="event<%= e.id %>">
				<%= render partial: "eventSingle", locals: { event: e } %>
			</div>
			<% end %>

			<% if !@near_me.present? %>
			
			No events match the specified criteria. <br>
			Try searching for a different location or <%=link_to 'create your own event.', new_event_path, method: :get %>
			
			<br/><br/>
			<%= form_tag user_path, :method => :get do %>	
			Categories: <br/>
			<%= select_tag :event_categories, options_for_select((list_categories), params[:event_categories] || ""), multiple: true %>
			<%= text_field_tag :location, params[:location], class: "input-group form-search",placeholder:"Location" %>

			<%= submit_tag "Search", :name => nil, class:"btn btn-xs"%>
			<% end %>

			<% end %>

			<br />

		</div>
		<br /><br /><br /><br /><br /><br /><br />
		<div class = "col-md-6">
			<% if @near_me.present? %>
			<div style='width: 800px;'>
				<div id="basic_map" style='width: 450px; height: 400px;'></div>
			</div>
			<br/> <br/>

			<%= form_tag user_path, :method => :get do %>	
			Categories: <br/>
			<%= select_tag :event_categories, options_for_select((list_categories), params[:event_categories] || ""), multiple: true %>
			<%= text_field_tag :location, params[:location], class: "input-group form-search",placeholder:"Location" %>

			<%= submit_tag "Search", :name => nil, class:"btn btn-xs"%>
			<% end %>
			<% end %>
		</div>
	</div>

</div>


<script type="text/javascript">
<% if @near_me.present? %>

var lat = parseFloat(<%= @near_me[0].latitude.to_s %>);
var lon = parseFloat(<%= @near_me[0].longitude.to_s %>);
<% else %>
var lat = parseFloat(<%=@result.latitude%>);
var lon = parseFloat(<%=@result.longitude%>);
<% end %>

var map;
var marker;
var markers=[];
initialize();
function initialize() {
	var latlng = new google.maps.LatLng(lat, lon);
	
	var myOptions = {
		zoom: 8,
		center: latlng,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};
	map = new google.maps.Map(document.getElementById("basic_map"),
		myOptions);
	map.setZoom(9);
	addMarker();
	
}
function addMarker() {
	<% @near_me.each do |post| %>
	var latlng = new google.maps.LatLng(parseFloat(<%=post.latitude%>),parseFloat(<%=post.longitude%>));
	markers.push(new RichMarker({
		position: latlng,
		map: map,
		anchor: RichMarkerPosition.MIDDLE,
		content:'<%= button_to '/events/' + post.id.to_s, :method => :get, :class=>"btn btn-info btn-noborder btn-xs" do%>' 
		+ '<span class="glyphicon glyphicon-chevron-down" color="red"></span>' 
		+ '<%end%>'
	}));
	<%end%>
}

google.maps.event.addDomListener(window, "load", initialize);

</script>