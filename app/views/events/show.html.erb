<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<div class = "row">
  <div class="col-md-6"> 
    <p id="notice"><%= notice %></p>
    <%= image_tag @event.image.url, :size => "600x290" %>

    <p>
      <h2><%= @event.name %></h2>
    </p>

    <p>
      <strong>Location:</strong>
      <%= @event.location %>
    </p>
    
    <p>
      <strong>Start:</strong>
      <%= @event.start_time.strftime("%A, %B %d, %Y") %> 
      at
      <%= @event.start_time.strftime("%I:%M %p")%>
    </p>
    
    <p>
      <strong>End:</strong>
      <%= @event.end_time.strftime("%A, %B %d, %Y") %> 
      at
      <%= @event.end_time.strftime("%I:%M %p")%>
    </p>
    
    <p>
      <strong>Description:</strong>
      <%= @event.description %>
    </p>
    
    <p>
    	<strong>Coordinates:</strong>
      	<%= @event.latitude %>, <%= @event.longitude %>
    </p>
    
	<p>
		<strong>Categories:</strong> <br />
		<% @event.event_categories.each do |cat|%>
		<%= cat.category %> <br />
		<% end %>
	</p>
  

  
  
    <div style='width: 800px;'>
  <div id="basic_map" style='width: 600px; height: 400px;'></div>
    </div>
<script type="text/javascript">
  var lat = parseFloat(<%=@event.latitude%>);
	var lon = parseFloat(<%=@event.longitude%>);

function initialize() {
    var latlng = new google.maps.LatLng(lat, lon);
    var myOptions = {
        zoom: 8,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("basic_map"),
            myOptions);
    map.setZoom(15);
    marker = new google.maps.Marker({
                      position: latlng,
                      map: map
         });
}
google.maps.event.addDomListener(window, "load", initialize);

</script>
  
     
      <br>
      <% if @event.user == current_user %>
      <%= link_to 'Edit', edit_event_path(@event)  %>
      |
      <%= link_to 'Back', events_path    %>
      <% else %>
      <%= link_to "Back", action: "show", controller: "users"%>
      <% end %>
    </p>
  </div>
  <div class="col-md-5 col-md-offset-1">
    <br>
    <br>
    <br>
    
    <ul class="list-group">
      <% if getComments(@event.id).count == 0 %>
        <li class="list-group-item">No one has commented on this event.</li>
      <% end %>
      <% getComments(@event.id) .each do |c| %> 
        <li class="list-group-item">
          <div class="row">
            <div class="col-md-2">
              <%= link_to User.find(c.user_id).name %>
            </div>
            <div class="col-md-10">
              <%= c.message %>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12" style="text-align: right; color: gray">
              <small ><%= format_time(c.created_at) %></small>
            </div>
          </div>
        </li>
      <% end %>
      <li class="list-group-item" style="padding-top: 15px; padding-bottom: 0px">
        <div class="row">
          <div class="col-md-12">
            <%= form_for :comment, url: { controller: 'events', action: 'createComment' } do |f| %>
              <div class="form-group">            
                <%= f.text_field :message, class: "form-control", placeholder: "Leave a comment..." %>
                <%= f.hidden_field :event_id, :value => @event.id %>
                <%= f.hidden_field :user_id, :value => current_user.id %>
              </div>        
            <% end %>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
